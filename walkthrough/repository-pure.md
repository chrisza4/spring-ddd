# Using Repository

เราก็จะสร้าง Repository ขึ้นมา ซึ่งยังไงก็จะอยู่นอกโดเมนเสมอไม่ว่าเราจะเลือกให้ Consume ที่ไหนก็ตาม

Notable:

- มีการเปลี่ยนชื่อจาก CarCollection Domain เป็น CarCollecting Domain แทน ตรงนี้ในชีวิตจริงก็เป็นไปได้ แต่ต้องคุยกับ Domain Expert เพื่อรักษา Ubiquitous Language เสมอ
- Repository คุณจะสร้างแบบโดเมนนึงอันนึงเลยก็ได้ เช่น CarCollection ทั้งโดเมนมีหนึ่ง Repository ดูแลทุกๆ Object หรือจะสร้างแบ่งเป็น CarCollectionRepository, StockRepository, LoadingRepository ให้ทุกๆ Entity มี Repository เป็นของตัวเองก็ได้ ตรงนี้ DDD ไม่ได้บังคับว่าต้องทำแบบไหนครับ แต่ในที่นี้ผมรวมไว้เป็นของโดเมนครับ
- สังเกตว่าเราต้องมี DAO แยกออกมาที่หน้าตาแทบจะเหมือนกับ Entity ทุกประการ แล้วก็มี Map มากมายมหาศาล เพราะว่าตามหลัก DDD แล้ว Domain ต้องไม่รู้อะไรเกี่ยวกับฐานข้อมูลและเทคโนโลยีของฐานข้อมูลเลย แค่ใส่ @Entity เข้าไปให้มันทำงานกับ CrudRepository ใน JPA ก็ไม่ได้ครับ ถือว่าทำแปดเปื้อนไปแล้ว คุณจะมีความรู้ว่าต้องมาร์คสิ่งนี้เป็น Entity และต้องมาร์คตัว Id ด้วย @Id และอาจจะต้องมารค์บางอย่างด้วย @ColumnName ไม่ได้เด็ดขาด!! และตรงนี้แหละที่คนอาจจะ Map พลาดได้ ก็น่าเป็นห่วงมากเหมือนกัน (ซึ่งหลักนี้ Practical มั้ยเดี๋ยวเราจะได้ Discuss)
- DDD ไม่ได้บังคับว่าจะ Implement Repository ด้วยเทคโนโลยีไหน เอาจริงๆ แล้วในยุค Eric Evans ส่วนมากจะเป็น Pure SQL ด้วยซ้ำ ยังไม่มี ORM ที่ดีที่เป็นที่ยอมรับ ทำให้ Original DDD เลยไม่ได้ความสงสัยมากว่า Map อะไรเยอะแยะนักหนา เพราะเขาเลี่ยงไม่ได้กันอยู่แล้ว
- มีการสร้าง UseCases ขึ้นมาเป็น Layer นึงใน Domain เพื่อบอกว่าตรงนี้เป็นจุดเชื่อมต่อกับโลกภายนอก
- เรา Define Repository ในโดเมน เพื่อเป็นการส่งสัญญาณว่าคนที่ออกแบบ Resository ที่ใช้ใน Domain ต้องทำตาม Interface ที่เหมาะสมกับ Domain นะ มากกว่าที่จะให้ข้างนอกแก้แล้วมากระทบ Domain เป็นหลักการจาก Clean Architecture ตรงนี้จะเห็นผลเยอะมากถ้าเราทำงานกันเป็นทีมใหญ่ๆ
- อยากให้สังเกตว่า ปริมาณโค้ดที่ต้องเขียนเพิ่มเยอะมากๆ และหลายๆ อย่างก็ซ้ำๆ กับอันเดิม
